# Steam 每日精选筛选应用需求文档

## 1. 项目背景
- 现有爬虫(`steam_daily.py`, `steam_recent_tag_scraper.py`, `steam_search_tag_scraper.py`)已能抓取未发布/早期阶段的 Steam 游戏，并生成 CSV/JSON。
- 当前使用链路需要人工打开 Steam 链接核对，移动端体验差，跳转耗时长。
- 目标是构建一个移动端友好、支持快速筛选的应用，帮助团队当天发现高潜游戏并记录偏好。

## 2. 项目目标
1. **快速筛选**：提供一个“左右滑”式交互界面，减少决策时间。
2. **无跳转阅读**：在列表/卡片内直接展示核心信息，无需跳转 Steam。
3. **行为留存**：将用户对游戏的喜欢/跳过操作记录下来，方便复盘与统计。
4. **团队协作**：支持多账号登录、权限控制，未来可拓展评论、打标签等功能。

## 3. 用户与使用场景
| Persona | 需求 | 典型操作 |
| --- | --- | --- |
| 策划/运营 | 每日快速浏览高潜游戏，生成关注列表 | 打开今日候选列表 → 滑动筛选 → 导出/查看收藏 |
| 数据分析 | 了解团队偏好、跟踪 watchlist 变化 | 按日期查询收藏，查看关注数变化 |
| 审核/管理 | 维护过滤规则与 watchlist | 调整抓取阈值、维护黑名单，手动标记 |

## 4. 功能需求
### 4.1 数据采集与处理
- 利用现有爬虫脚本生成的 CSV/JSON 作为数据源。
- 每日定时任务：抓取 → 清洗去重 → 写入数据库 → 生成 “今日候选列表” 视图。
- 记录原始抓取批次（来源脚本、运行时间、参数）。

### 4.2 用户系统与权限
- Django 认证体系：邮箱/用户名 + 密码登陆。
- 角色：`viewer`（浏览/滑动）、`editor`（维护候选与 watchlist）、`admin`（配置管理）。
- 支持通过 Django Admin 管理抓取记录、候选游戏、黑名单。

### 4.3 候选池浏览
- 默认按“今日发现”展示卡片，支持切换日期。
- 卡片展示：封面（可选）、名称、标签、关注数、愿望单估算、简介、发行时间、来源脚本。
- 支持筛选：按标签分类（narrative/cozy…）、关注数区间、是否在 watchlist。
- 详情面板内嵌 Steam 要点，不强制跳转，可在后台预拉取详细描述。

### 4.4 滑动与收藏
- 左滑=跳过，右滑=收藏；支持按钮操作替代手势。
- 记录操作：用户、游戏、动作、时间、附注（可选）。
- 收藏列表（“喜欢”）支持导出 CSV/JSON，支持快速分享。
- 日志用于生成日报或统计报表（例如热门标签、转化率）。

### 4.5 Watchlist 集成
- 从 `steam_data/early_stage_watchlist.json` 导入历史追踪数据。
- 在 UI 中显示 watchlist 状态、首次检测时间、最近状态。
- 支持在后台修改 watchlist 备注、状态或手动添加 AppID。

### 4.6 管理工具
- 后台页面支持：抓取批次管理、黑名单维护、标签/过滤规则配置。
- 配置可设定关注者阈值、目标标签、关键词黑名单。

## 5. 非功能需求
- **性能**：首屏加载 ≤ 3 秒，卡片切换即时响应；API 延迟 < 200ms（缓存后）。
- **吞吐**：每日候选量约 100～300 条；需要支持多人并发浏览。
- **移动端友好**：优先设计移动 Web（可扩展为 PWA）。
- **可观测性**：记录抓取任务日志，监控失败重试。
- **数据一致性**：所有滑动、收藏行为实时落库；支持回放历史动作。
- **安全**：HTTPS 部署、CSRF 保护、权限校验；敏感配置使用 `.env` 管理。

## 6. 系统架构概述
1. **采集层**：现有 Python 爬虫，通过 Cron/Celery 调度，落地原始 CSV/JSON。
2. **导入层**：Django 管理命令读取 CSV/JSON，执行去重与字段清洗，写入数据库模型。
3. **业务层**：Django 应用提供 REST API（后续可扩展 GraphQL），封装筛选逻辑。
4. **前端层**：移动优先的 Web 应用（React/Next 或 SvelteKit 等），与后端交互。
5. **状态层**：数据库（PostgreSQL/MySQL）保存游戏、批次、用户行为；Redis 可选用于缓存。

## 7. 数据模型草案
- `Game`: Steam App 主数据（AppID、名称、标签、关注数、描述、来源字段）。
- `DiscoveryBatch`: 抓取批次（来源脚本、运行时间、原始文件路径）。
- `GameSnapshot`: 每批次的游戏快照，保存当时统计数据。
- `WatchlistEntry`: 迁移自 JSON，记录追踪状态、历史、备注。
- `SwipeAction`: 用户行为日志，字段包括用户、游戏、动作（like/skip）、时间、备注。
- `UserPreference`（可选）：用户级偏好设置（默认筛选条件等）。

## 8. 集成与迁移
1. **配置**：新增 `config/settings_local.py` 或 `.env` 扩展，管理数据库连接、邮件参数。
2. **依赖**：`requirements.txt` 增加 `Django`, `django-environ` 等后端依赖。
3. **数据迁移**：
   - Watchlist JSON → Django 模型（单次导入 + 定期同步）。
   - 历史 CSV（如 `new_games_YYYY-MM-DD.csv`）可择机批量导入。
4. **任务调度**：`followers-tracker.service`/cron 触发 Django 管理命令，统一日志。

## 9. 里程碑与交付
| 里程碑 | 目标 | 产出 |
| --- | --- | --- |
| M0 需求与设计 | 确认需求、UI 草图、后端架构 | 需求文档、UI 文档、技术选型 |
| M1 后端基础 | Django 项目、模型、导入脚本、基础 API | 运行中的后端服务、自动化导入 |
| M2 前端原型 | 移动端界面、滑动交互、收藏记录 | 原型站点或 PWA、API 联调 |
| M3 迭代优化 | Watchlist 深度整合、统计报表 | 管理后台、报表、性能优化 |

## 10. 风险与对策
- **Steam 反爬策略变化**：保持速率限制、UA 伪装，必要时使用代理。
- **数据质量**：需完善去重与黑名单规则，避免重复/低质内容。
- **移动端性能**：关注卡片渲染性能、图片加载策略（懒加载、CDN）。
- **多用户协作**：需要操作日志与冲突处理（同一游戏多用户操作时的展示策略）。

---
本文档作为后续设计与开发基线，更新时请记录版本及变更说明。
